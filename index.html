<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDOGRA - Pedidos</title>
    <style>
        :root { --azul: #007bff; --verde: #25d366; --gris: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--gris); margin: 0; padding: 10px; }
        .card { max-width: 550px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 15px; border-bottom: 2px solid var(--azul); padding-bottom: 10px; }
        .logo { width: 140px; height: auto; }
        h2 { color: var(--azul); margin: 5px 0; font-size: 1.4em; }
        input { width: 100%; padding: 12px; margin: 6px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        #search { background: #fffde7; border: 2px solid var(--azul); font-weight: bold; position: sticky; top: 0; z-index: 10; }
        .lista { max-height: 400px; overflow-y: auto; border: 1px solid #eee; padding: 5px; margin-top: 10px; border-radius: 8px; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px 5px; border-bottom: 1px solid #f0f0f0; }
        .item-info { flex: 1; font-size: 0.85em; color: #333; }
        .item-info b { display: block; font-size: 1.05em; color: #000; }
        .qty { width: 75px !important; text-align: center; border: 2px solid var(--azul) !important; font-weight: bold; background: #e3f2fd; }
        .footer { position: sticky; bottom: 0; background: white; padding: 15px; border-top: 3px solid var(--azul); margin-top: 15px; }
        .total-box { display: flex; justify-content: space-between; font-size: 1.4em; font-weight: bold; color: var(--azul); margin-bottom: 12px; }
        .btn-ws { background: var(--verde); color: white; border: none; width: 100%; padding: 16px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1em; margin-bottom: 8px; }
        .btn-backup { background: #6c757d; color: white; border: none; width: 100%; padding: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <img src="edogra.png" alt="Logo EDOGRA" class="logo">
        <h2>EDOGRA DISTRIBUCIONES</h2>
        <div id="fecha" style="font-size: 0.85em; color: #666; font-weight: bold;"></div>
    </div>

    <input type="text" id="cliente" placeholder="Nombre del Cliente">
    <input type="text" id="tienda" placeholder="Nombre de la Tienda">
    <input type="text" id="dir" placeholder="DirecciÃ³n completa y Ciudad">
    <input type="text" id="vend" placeholder="Nombre del Vendedor">

    <input type="text" id="search" placeholder="ðŸ” BUSCAR PRODUCTO..." onkeyup="filtrar()">

    <div class="lista" id="lista"></div>

    <div class="footer">
        <div class="total-box">
            <span>TOTAL:</span>
            <span id="totalDisplay">$0</span>
        </div>
        <button class="btn-ws" onclick="enviar()">ðŸš€ ENVIAR A WHATSAPP</button>
        <button class="btn-backup" onclick="guardarBackup()">ðŸ’¾ GUARDAR BACKUP LOCAL</button>
        <p style="text-align: center; font-size: 0.75em; color: #888; margin-top: 10px;">
            App Desarrollada por <b>Vibras Positivas</b>
        </p>
    </div>
</div>

<script>
    const PRODUCTOS = [
        { id: 1, n: "Detergente 3D *125GR PC*96", p: 1335 },
        { id: 2, n: "Detergente 3D *1KL PC*12", p: 7565 },
        { id: 3, n: "Detergente 3D *250GR PC*24", p: 2580 },
        { id: 4, n: "Detergente 3D *2KL PC*6", p: 15115 },
        { id: 5, n: "Detergente 3D *3KL PC*4", p: 22020 },
        { id: 6, n: "Detergente Fab *450GR PC*30", p: 5345 },
        { id: 7, n: "Detergente Fab *4KL PC*4", p: 42770 },
        { id: 8, n: "Detergente Ultrex *125GR PC*96", p: 755 },
        { id: 9, n: "Detergente Ultrex *1KL PC*20", p: 5560 },
        { id: 10, n: "Detergente Ultrex Manz *500GR PC*40", p: 2800 },
        { id: 11, n: "Blanqueador Patojito *1000ML CJ*18", p: 51465 },
        { id: 12, n: "Blanqueador Patojito *1800ML CJ*12", p: 59545 },
        { id: 13, n: "Suavizante Aromatel *900ML CJ*12", p: 8900 },
        { id: 14, n: "Suavizante Suavitel *1LT CJ*12", p: 8350 },
        { id: 15, n: "Jabon Rey *300GR CJ*25", p: 72555 },
        { id: 16, n: "Jabon Caiman Azul *230GR CJ*25", p: 42225 },
        { id: 17, n: "Lavaloza Axion Barra *150GR CJ*72", p: 2225 },
        { id: 18, n: "Lavaloza Axion Barra *450GR CJ*24", p: 6170 },
        { id: 19, n: "Lavaloza Patojito *450GR CJ*36", p: 3695 },
        { id: 20, n: "Lavaloza Liquido 123 *500ML CJ*12", p: 3195 }
    ];

    function updateDate() {
        const opciones = { timeZone: 'America/Bogota', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        document.getElementById('fecha').innerText = new Date().toLocaleString('es-CO', opciones);
    }
    updateDate();

    const container = document.getElementById('lista');
    PRODUCTOS.forEach(p => {
        const div = document.createElement('div');
        div.className = 'item';
        div.setAttribute('data-n', p.n.toLowerCase());
        div.innerHTML = `<div class="item-info"><b>${p.n}</b>$${p.p.toLocaleString()}</div>
                         <input type="number" class="qty" id="qty-${p.id}" placeholder="0" oninput="calc()">`;
        container.appendChild(div);
    });

    function filtrar() {
        const q = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('.item').forEach(i => {
            i.style.display = i.getAttribute('data-n').includes(q) ? 'flex' : 'none';
        });
    }

    function calc() {
        let total = 0;
        PRODUCTOS.forEach(p => {
            total += (document.getElementById(`qty-${p.id}`).value || 0) * p.p;
        });
        document.getElementById('totalDisplay').innerText = `$${total.toLocaleString()}`;
    }

    function enviar() {
        const cli = document.getElementById('cliente').value;
        const tie = document.getElementById('tienda').value;
        const dir = document.getElementById('dir').value;
        const ven = document.getElementById('vend').value;

        if(!cli || !tie || !dir) return alert("Faltan datos del cliente");

        let msg = `*PEDIDO EDOGRA*\n*Cliente:* ${cli}\n*Tienda:* ${tie}\n*DirecciÃ³n:* ${dir}\n*Vendedor:* ${ven}\n\n`;
        let subtotal = 0;
        PRODUCTOS.forEach(p => {
            const q = document.getElementById(`qty-${p.id}`).value;
            if(q > 0) {
                msg += `â€¢ ${p.n}: ${q} x $${p.p.toLocaleString()} = *$${(q*p.p).toLocaleString()}*\n`;
                subtotal += q * p.p;
            }
        });

        if(subtotal === 0) return alert("Pedido vacÃ­o");

        msg += `\n*TOTAL: $${subtotal.toLocaleString()}*\n\n_App por Vibras Positivas_`;
        window.open(`https://wa.me/573178449331?text=${encodeURIComponent(msg)}`);
    }

    function guardarBackup() {
        const datos = {
            c: document.getElementById('cliente').value,
            t: document.getElementById('tienda').value,
            d: document.getElementById('dir').value,
            p: []
        };
        PRODUCTOS.forEach(p => {
            const q = document.getElementById(`qty-${p.id}`).value;
            if(q > 0) datos.p.push({id: p.id, q: q});
        });
        localStorage.setItem('backup_edogra', JSON.stringify(datos));
        alert("Â¡Backup guardado! Si recargas la pÃ¡gina, tus datos seguirÃ¡n aquÃ­.");
    }

    // Cargar backup si existe
    window.onload = () => {
        const saved = JSON.parse(localStorage.getItem('backup_edogra'));
        if(saved) {
            document.getElementById('cliente').value = saved.c || '';
            document.getElementById('tienda').value = saved.t || '';
            document.getElementById('dir').value = saved.d || '';
            saved.p.forEach(item => {
                const el = document.getElementById(`qty-${item.id}`);
                if(el) el.value = item.q;
            });
            calc();
        }
    };
</script>
</body>
</html>
