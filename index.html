<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDOGRA - Toma de Pedidos</title>
    <style>
        :root {
            --azul-edogra: #007bff;
            --azul-oscuro: #0056b3;
            --blanco: #ffffff;
            --gris-claro: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--gris-claro);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: var(--blanco);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            border-bottom: 3px solid var(--azul-edogra);
            margin-bottom: 20px;
            padding-bottom: 10px;
        }

        .header h1 { color: var(--azul-edogra); margin: 0; }
        .datetime { font-size: 0.9em; color: #666; }

        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #333; }
        
        input[type="text"], input[type="tel"], input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
        }

        .product-list { margin-top: 20px; }
        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .product-info { flex: 2; }
        .product-price { color: var(--azul-oscuro); font-weight: bold; font-size: 0.9em; }

        .qty-input {
            width: 80px !important;
            text-align: center;
            border: 2px solid var(--azul-edogra) !important;
        }

        .totals-section {
            position: sticky;
            bottom: 0;
            background: var(--blanco);
            padding: 15px;
            border-top: 2px solid var(--azul-edogra);
            margin-top: 20px;
            text-align: right;
        }

        .total-amount { font-size: 1.5em; color: var(--azul-edogra); font-weight: bold; }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 10px;
        }

        .btn-whatsapp { background-color: #25d366; color: white; }
        .btn-backup { background-color: var(--azul-edogra); color: white; }
        .btn-edit { background-color: #ffc107; color: black; font-size: 0.8em; padding: 5px; width: auto; }

        .btn:hover { opacity: 0.8; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>EDOGRA DISTRIBUCIONES</h1>
        <p>Vibras Positivas para tu negocio</p>
        <div class="datetime" id="currentDateTime"></div>
    </div>

    <div id="clienteSection">
        <div class="form-group">
            <label>Nombre del Cliente</label>
            <input type="text" id="nombreCliente" placeholder="Ej: Juan Pérez">
        </div>
        <div class="form-group">
            <label>Nombre de la Tienda</label>
            <input type="text" id="nombreTienda" placeholder="Ej: Supermercado El Éxito">
        </div>
        <div class="form-group">
            <label>Dirección y Ciudad</label>
            <input type="text" id="direccion" placeholder="Ej: Calle 10 #5-20, Caucasia">
        </div>
        <div class="form-group">
            <label>Celular Cliente</label>
            <input type="tel" id="celularCliente" placeholder="300...">
        </div>
        <div class="form-group">
            <label>Vendedor</label>
            <input type="text" id="vendedor" placeholder="Nombre del preventista">
        </div>
    </div>

    <div class="product-list">
        <h3>Catálogo de Productos</h3>
        <div id="productosContainer">
            </div>
    </div>

    <div class="totals-section">
        <div>Subtotal: <span id="subtotalLabel">$0</span></div>
        <div class="total-amount">TOTAL: <span id="totalLabel">$0</span></div>
        
        <button class="btn btn-whatsapp" onclick="enviarWhatsApp()">Enviar Pedido a WhatsApp</button>
        <button class="btn btn-backup" onclick="guardarBackup()">Guardar Backup Local</button>
    </div>
    
    <p style="text-align: center; font-size: 0.8em; color: #888; margin-top: 20px;">
        App Desarrollada por <b>Vibras Positivas</b>
    </p>
</div>

<script>
    const PRODUCTOS = [
        { id: 1, nombre: "Detergente 3D *125GR", empaque: "PC*96", precio: 1335 },
        { id: 2, nombre: "Detergente Ultrex *1KL", empaque: "PC*20", precio: 5560 },
        { id: 3, nombre: "Blanqueador Patojito *1000ML", empaque: "CJ*18", precio: 51465 },
        { id: 4, nombre: "Suavizante Suavitel *1LT", empaque: "CJ*12", precio: 8350 },
        { id: 5, nombre: "Jabon Rey *300GR", empaque: "25 UND", precio: 72555 },
        { id: 6, nombre: "Lavaloza Axion Barra *150GR", empaque: "CJ*72", precio: 2225 },
        { id: 7, nombre: "Lavaloza Patojito *235GR", empaque: "CJ*36", precio: 2280 }
    ];

    // Mostrar Fecha y Hora de Colombia
    function updateDateTime() {
        const ahora = new Date();
        const opciones = { timeZone: 'America/Bogota', hour12: true, year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
        document.getElementById('currentDateTime').innerText = ahora.toLocaleString('es-CO', opciones);
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Renderizar Productos
    const container = document.getElementById('productosContainer');
    PRODUCTOS.forEach(p => {
        const div = document.createElement('div');
        div.className = 'product-item';
        div.innerHTML = `
            <div class="product-info">
                <div><strong>${p.nombre}</strong></div>
                <div class="product-price">$${p.precio.toLocaleString()} | ${p.empaque}</div>
            </div>
            <div>
                <input type="number" class="qty-input" id="qty-${p.id}" placeholder="Cant" min="0" oninput="calcularTotal()">
            </div>
        `;
        container.appendChild(div);
    });

    function calcularTotal() {
        let total = 0;
        PRODUCTOS.forEach(p => {
            const qty = document.getElementById(`qty-${p.id}`).value || 0;
            total += qty * p.precio;
        });
        document.getElementById('subtotalLabel').innerText = `$${total.toLocaleString()}`;
        document.getElementById('totalLabel').innerText = `$${total.toLocaleString()}`;
        return total;
    }

    function enviarWhatsApp() {
        const nombre = document.getElementById('nombreCliente').value;
        const tienda = document.getElementById('nombreTienda').value;
        const vendedor = document.getElementById('vendedor').value;
        const fecha = document.getElementById('currentDateTime').innerText;

        if(!nombre || !tienda) {
            alert("Por favor completa los datos del cliente");
            return;
        }

        let mensaje = `*FACTURA DE PEDIDO - EDOGRA*\n`;
        mensaje += `--------------------------------\n`;
        mensaje += `*Fecha:* ${fecha}\n`;
        mensaje += `*Cliente:* ${nombre}\n`;
        mensaje += `*Tienda:* ${tienda}\n`;
        mensaje += `*Vendedor:* ${vendedor}\n`;
        mensaje += `--------------------------------\n`;
        mensaje += `*DETALLE DEL PEDIDO:*\n\n`;

        let total = 0;
        PRODUCTOS.forEach(p => {
            const qty = document.getElementById(`qty-${p.id}`).value;
            if (qty > 0) {
                const sub = qty * p.precio;
                mensaje += `• ${p.nombre}\n  Cant: ${qty} x $${p.precio.toLocaleString()} = *$${sub.toLocaleString()}*\n`;
                total += sub;
            }
        });

        if(total === 0) {
            alert("El pedido está vacío");
            return;
        }

        mensaje += `\n--------------------------------\n`;
        mensaje += `*TOTAL A PAGAR: $${total.toLocaleString()}*\n`;
        mensaje += `--------------------------------\n`;
        mensaje += `¡Muchas gracias por su compra!\n\n`;
        mensaje += `_App desarrollada por Vibras Positivas_`;

        const phone = "57317849331";
        const url = `https://api.whatsapp.com/send?phone=${phone}&text=${encodeURIComponent(mensaje)}`;
        window.open(url, '_blank');
    }

    function guardarBackup() {
        const datos = {
            cliente: document.getElementById('nombreCliente').value,
            tienda: document.getElementById('nombreTienda').value,
            fecha: new Date().toISOString(),
            pedido: []
        };
        
        PRODUCTOS.forEach(p => {
            const qty = document.getElementById(`qty-${p.id}`).value;
            if(qty > 0) datos.pedido.push({ nombre: p.nombre, cantidad: qty });
        });

        localStorage.setItem('ultimo_pedido_edogra', JSON.stringify(datos));
        alert("Backup guardado exitosamente en este dispositivo.");
    }
</script>

</body>
</html>
